<!doctype html>
<html lang="zh-cn">

<head>
  <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<meta property="og:title" content="简易问卷系统（三）代码编辑器和组件动态调用" />
<meta property="og:description" content="前言 最开始讲过这个问卷系统的设计特点，可以让用户来自己写问卷的题型组件，而且要利用React的框架。 既然这样，那必不可少需要一个优秀的在线代" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xuhongxu.com/2018/09/%E7%AE%80%E6%98%93%E9%97%AE%E5%8D%B7%E7%B3%BB%E7%BB%9F%E4%B8%89%E4%BB%A3%E7%A0%81%E7%BC%96%E8%BE%91%E5%99%A8%E5%92%8C%E7%BB%84%E4%BB%B6%E5%8A%A8%E6%80%81%E8%B0%83%E7%94%A8/" />
<meta property="article:published_time" content="2018-09-02T22:00:20+08:00" />
<meta property="article:modified_time" content="2018-09-02T22:00:20+08:00" /><meta property="og:site_name" content="旭旭" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="简易问卷系统（三）代码编辑器和组件动态调用"/>
<meta name="twitter:description" content="前言 最开始讲过这个问卷系统的设计特点，可以让用户来自己写问卷的题型组件，而且要利用React的框架。 既然这样，那必不可少需要一个优秀的在线代"/>



  <link rel="canonical" href="https://xuhongxu.com/2018/09/%E7%AE%80%E6%98%93%E9%97%AE%E5%8D%B7%E7%B3%BB%E7%BB%9F%E4%B8%89%E4%BB%A3%E7%A0%81%E7%BC%96%E8%BE%91%E5%99%A8%E5%92%8C%E7%BB%84%E4%BB%B6%E5%8A%A8%E6%80%81%E8%B0%83%E7%94%A8/">

  <title>
    
    简易问卷系统（三）代码编辑器和组件动态调用 | 旭旭
    
  </title>

  
  <link rel="stylesheet" href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.css"
    crossorigin="anonymous">

  <link href="https://xuhongxu.com/css/style.css" rel="stylesheet">

  

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-69634713-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">
<script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>

  

</head>

<body>
  
  <header class="blog-header">
    <nav class="navbar navbar-expand-md navbar-light bg-light">
        <a class="navbar-brand" href="/">
            旭旭
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false"
            aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse justify-content-between" id="navbarNav">
            <ul class="navbar-nav">
                
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/">主页</a>
                    
                </li>
                
                <li class="nav-item ">
                    
                        <a class="nav-link" href="/about/">关于</a>
                    
                </li>
                
            </ul>
            
            <ul class="navbar-nav">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        语言
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                        
                            <a class="dropdown-item" href="https://xuhongxu.com/">简体中文</a>
                        
                            <a class="dropdown-item" href="https://xuhongxu.com/en/">English</a>
                        
                    </div>
                </li>
            </ul>
            
        </div>
    </nav>
</header>
  

  
  
    <div class="container">
      
      <div class="row">
        <div class="col-12 col-lg-8 blog-main">

          

<header>
    <h2 class="blog-post-title">
        <a class="text-dark" href="/2018/09/%E7%AE%80%E6%98%93%E9%97%AE%E5%8D%B7%E7%B3%BB%E7%BB%9F%E4%B8%89%E4%BB%A3%E7%A0%81%E7%BC%96%E8%BE%91%E5%99%A8%E5%92%8C%E7%BB%84%E4%BB%B6%E5%8A%A8%E6%80%81%E8%B0%83%E7%94%A8/">简易问卷系统（三）代码编辑器和组件动态调用</a>
    </h2>
    


<div class="blog-post-date text-secondary">
    
        Sep 2, 2018
    
    
        作者 <span rel="author">许宏旭</span>
    
</div>

    
<div class="blog-post-tags text-secondary">
    <strong>标签:</strong>
    
        <a class="badge badge-primary" href="/tags/monaco">Monaco</a>
    
        <a class="badge badge-primary" href="/tags/react">React</a>
    
        <a class="badge badge-primary" href="/tags/typescript">TypeScript</a>
    
        <a class="badge badge-primary" href="/tags/asp.net-core">ASP.NET Core</a>
    
</div>

    
<div class="blog-post-categories text-secondary">
    <strong>分类:</strong>
    
        <a class="badge badge-primary" href="/categories/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0">开发笔记</a>
    
</div>

    <hr>
</header>
<article class="blog-post">
    <h2 id="前言">前言</h2>
<p>最开始讲过这个问卷系统的设计特点，可以让用户来自己写问卷的题型组件，而且要利用React的框架。</p>
<p>既然这样，那必不可少需要一个优秀的在线代码编辑器。</p>
<p>大家都知道VSCode很好用，VSCode是用TypeScript写的，然后封装成的桌面程序。其实，微软有把VSCode使用的编辑器抽离简化出来，叫做Monaco Editor，可以在浏览器中使用。</p>
<p>Monaco Editor虽说相比VSCode的编辑器简化了很多，但仍然提供了很强大的功能，例如Highlighting（代码高亮）和Intellisense（智能感知）等等。再加上对TypeScript的良好支持，成为了当前项目的首选编辑器。</p>
<h2 id="安装-monaco-editor">安装 Monaco Editor</h2>
<blockquote>
<p>npm install react-monaco-editor</p>
</blockquote>
<p>这是社区维护的，Monaco Editor的React组件封装，<a href="https://github.com/superRaytin/react-monaco-editor">react-monaco-editor</a>。</p>
<h2 id="设计">设计</h2>
<h3 id="创建题目表单属性接口">创建题目表单属性接口</h3>
<p>该问卷题型被问卷创建者添加后，对该题目进行编辑的表单，即创建题目表单。</p>
<p>该表单属性接口定义了该题型被加入问卷对应的题目，该问卷所有的题目，以及存放创建者对题型编辑的设置信息。<br>
同时还定义了一个事件，当创建者编辑题型的设置信息改变时触发。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">declare</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">ICreateQuestionTypeComponentProps</span> {
    <span style="color:#a6e22e">question</span>: <span style="color:#66d9ef">IQuestionModel</span>,
    <span style="color:#a6e22e">questions</span>: <span style="color:#66d9ef">IQuestionModel</span>[],
    <span style="color:#a6e22e">content</span>: <span style="color:#66d9ef">string</span>, <span style="color:#75715e">// save settings in [content]
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">onContentChanged</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">content</span>: <span style="color:#66d9ef">string</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">void</span>,
}
</code></pre></div><h3 id="展示题目表单属性接口">展示题目表单属性接口</h3>
<p>该问卷题型在已发布的问卷中，被问卷作答者看到和填写的表单，即展示题目表单。</p>
<p>该表单属性接口定义了该题型被加入问卷对应的题目，该问卷所有的题目，该问卷当前用户作答的全部答案，创建者的题型设置，以及存放当前题目作答者的答案。<br>
同时还定义了一个事件，当作答者确认提交本题目时触发。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">declare</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IShowQuestionTypeComponentProps</span> {
    <span style="color:#a6e22e">question</span>: <span style="color:#66d9ef">IQuestionModel</span>,
    <span style="color:#a6e22e">questions</span>: <span style="color:#66d9ef">IQuestionModel</span>[],
    <span style="color:#a6e22e">answers</span>: <span style="color:#66d9ef">IAnswerModel</span>[],
    <span style="color:#a6e22e">createContent</span>: <span style="color:#66d9ef">string</span>, <span style="color:#75715e">// [ICreateQuestionTypeComponentProps.content] settings of the component
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">content</span>: <span style="color:#66d9ef">string</span>, <span style="color:#75715e">// save answer in [content]
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">onSubmit</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">content</span>: <span style="color:#66d9ef">string</span>, <span style="color:#a6e22e">nextQuestionIndex?</span>: <span style="color:#66d9ef">number</span>) <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">void</span>,
}
</code></pre></div><h3 id="题型样例填空题">题型样例：填空题</h3>
<p><strong>约定</strong>：题型的类名均为<code>ExampleQuestionType</code>。</p>
<h4 id="创建题目表单代码">创建题目表单代码</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IExampleQuestionTypeState</span> {
    <span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">string</span>,
}

<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExampleQuestionType</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">Component</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">ICreateQuestionTypeComponentProps</span>, <span style="color:#a6e22e">IExampleQuestionTypeState</span><span style="color:#f92672">&gt;</span> {

    <span style="color:#66d9ef">constructor</span>(<span style="color:#a6e22e">props</span>: <span style="color:#66d9ef">ICreateQuestionTypeComponentProps</span>) {
        <span style="color:#66d9ef">super</span>(<span style="color:#a6e22e">props</span>);

        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_onValueChanged</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_onValueChanged</span>.<span style="color:#a6e22e">bind</span>(<span style="color:#66d9ef">this</span>);
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> {
            <span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">this.props.content</span>,
        }
    }

    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">_onValueChanged</span>(<span style="color:#a6e22e">event</span>: <span style="color:#66d9ef">any</span>) {
        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">content</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">value</span>;

        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setState</span>({
            <span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">content</span>,
        });

        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">onContentChanged</span>(<span style="color:#a6e22e">content</span>);
    }

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">render() {</span>
        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">text</span>;
        <span style="color:#66d9ef">return</span> (
            <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>
                <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">label</span><span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Please</span> <span style="color:#a6e22e">input</span> <span style="color:#a6e22e">something</span> <span style="color:#a6e22e">to</span> <span style="color:#a6e22e">show</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/label&gt;</span>
                <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;text&#39;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">text</span>} <span style="color:#a6e22e">onChange</span><span style="color:#f92672">=</span>{<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_onValueChanged</span>} <span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
        );
    }

}
</code></pre></div><h4 id="展示题目表单代码">展示题目表单代码</h4>
<p><strong>约定</strong>：<code>getReportTitle</code>和<code>getReportRow</code>分别用于获取该题型在问卷报告中的标题（表头），以及根据作答者的答案内容转换后的报告中的一行数据。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IExampleQuestionTypeState</span> {
    <span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">string</span>,
}

<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExampleQuestionType</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">React</span>.<span style="color:#a6e22e">Component</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">IShowQuestionTypeComponentProps</span>, <span style="color:#a6e22e">IExampleQuestionTypeState</span><span style="color:#f92672">&gt;</span> {
    <span style="color:#66d9ef">constructor</span>(<span style="color:#a6e22e">props</span>: <span style="color:#66d9ef">IShowQuestionTypeComponentProps</span>) {
        <span style="color:#66d9ef">super</span>(<span style="color:#a6e22e">props</span>);

        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_onValueChanged</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_onValueChanged</span>.<span style="color:#a6e22e">bind</span>(<span style="color:#66d9ef">this</span>);
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_onSubmit</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_onSubmit</span>.<span style="color:#a6e22e">bind</span>(<span style="color:#66d9ef">this</span>);

        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> {
            <span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">this.props.content</span>,
        };
    }

    <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">getReportTitle() {</span>
        <span style="color:#66d9ef">return</span> [<span style="color:#e6db74">&#39;题型&#39;</span>, <span style="color:#e6db74">&#39;答案&#39;</span>];
    }

    <span style="color:#66d9ef">static</span> <span style="color:#a6e22e">getReportRow</span>(<span style="color:#a6e22e">content</span>: <span style="color:#66d9ef">string</span>) {
        <span style="color:#66d9ef">return</span> [<span style="color:#e6db74">&#39;填空题&#39;</span>, <span style="color:#a6e22e">content</span>];
    }

    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">_onValueChanged</span>(<span style="color:#a6e22e">event</span>: <span style="color:#66d9ef">any</span>) {
        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">content</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">target</span>.<span style="color:#a6e22e">value</span>;
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setState</span>({
            <span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">content</span>,
        });
    }

    <span style="color:#66d9ef">private</span> <span style="color:#a6e22e">_onSubmit</span>(<span style="color:#a6e22e">event</span>: <span style="color:#66d9ef">any</span>) {
        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">content</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">text</span>;
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">onSubmit</span>(<span style="color:#a6e22e">content</span>);
    }

    <span style="color:#a6e22e">componentWillReceiveProps</span>(<span style="color:#a6e22e">nextProps</span>: <span style="color:#66d9ef">IShowQuestionTypeComponentProps</span>) {
        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">content</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">nextProps</span>.<span style="color:#a6e22e">content</span>;

        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setState</span>({
            <span style="color:#a6e22e">text</span>: <span style="color:#66d9ef">content</span>,
        });
    }

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">render() {</span>

        <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">text</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">text</span>;

        <span style="color:#66d9ef">return</span> (
            <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>
                <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">label</span><span style="color:#f92672">&gt;</span>{<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">createContent</span>}<span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/label&gt;</span>
                <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">input</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;text&#39;</span> <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">text</span>} <span style="color:#a6e22e">onChange</span><span style="color:#f92672">=</span>{<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_onValueChanged</span>} <span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">button</span> <span style="color:#a6e22e">onClick</span><span style="color:#f92672">=</span>{<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_onSubmit</span>}<span style="color:#f92672">&gt;</span><span style="color:#a6e22e">Submit</span><span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/button&gt;</span>
            <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
        );
    }
}
</code></pre></div><h2 id="调用-monaco-编辑器">调用 Monaco 编辑器</h2>
<p>首先导入包不用多说：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">MonacoEditor</span> <span style="color:#a6e22e">from</span> <span style="color:#e6db74">&#39;react-monaco-editor&#39;</span>;
</code></pre></div><p>然后在<code>render</code>函数中，加入<code>&lt;MonacoEditor&gt;</code>组件：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">codeCreate</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">createFormTSX</span>; <span style="color:#75715e">// 创建题目表单代码
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">isOnlyView</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">isOnlyView</span>; <span style="color:#75715e">// 是否只读
</span><span style="color:#75715e"></span>
<span style="color:#75715e">// Monaco Editor的JS库源文件（最新版貌似可以通过安装WebPack Plugin来导入，无需指定源文件目录）
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">requireConfig</span> <span style="color:#f92672">=</span> { 
    <span style="color:#a6e22e">url</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;dist/vs/loader.js&#39;</span>,
    <span style="color:#a6e22e">paths</span><span style="color:#f92672">:</span> {
        <span style="color:#e6db74">&#39;vs&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;dist/vs&#39;</span>,
    }
};

<span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>
<span style="color:#f92672">&lt;</span><span style="color:#a6e22e">MonacoEditor</span>
    <span style="color:#a6e22e">width</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;100%&#34;</span>
    <span style="color:#a6e22e">height</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;600&#34;</span>
    <span style="color:#a6e22e">language</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;typescript&#34;</span>
    <span style="color:#a6e22e">theme</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;vs-dark&#34;</span>
    <span style="color:#a6e22e">value</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">codeCreate</span>}
    <span style="color:#a6e22e">options</span><span style="color:#f92672">=</span>{{ <span style="color:#a6e22e">readOnly</span>: <span style="color:#66d9ef">isOnlyView</span> }}
    <span style="color:#a6e22e">requireConfig</span><span style="color:#f92672">=</span>{<span style="color:#a6e22e">requireConfig</span>}
    <span style="color:#a6e22e">editorDidMount</span><span style="color:#f92672">=</span>{ (<span style="color:#a6e22e">editor</span>, <span style="color:#a6e22e">monaco</span>) <span style="color:#f92672">=&gt;</span>
        { 
                <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_initEditor</span>(); 
                <span style="color:#a6e22e">editor</span>.<span style="color:#a6e22e">setModel</span>(<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_createFormEditorModel</span>); 
        }
    }
    <span style="color:#a6e22e">onChange</span><span style="color:#f92672">=</span>{<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_onCreateFormChanged</span>}
<span style="color:#960050;background-color:#1e0010">/&gt;</span>
</code></pre></div><h3 id="初始化-monacoeditor">初始化 MonacoEditor</h3>
<p>可以看到，上面调用<code>&lt;MonacoEditor&gt;</code>组件中，调用了<code>this._initEditor</code>，并将<code>this._createFormEditorModel</code>设置到编辑器的模型（即内容和内容的相关设定）中。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">private</span> <span style="color:#a6e22e">_initEditor() {</span>

    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">model</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">model</span>;

    <span style="color:#75715e">// 设置Monaco编辑器TypeScript的编译特性
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">languages</span>.<span style="color:#a6e22e">typescript</span>.<span style="color:#a6e22e">typescriptDefaults</span>.<span style="color:#a6e22e">setCompilerOptions</span>({
        <span style="color:#a6e22e">declaration</span>: <span style="color:#66d9ef">false</span>, <span style="color:#75715e">// 不是定义文件
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">target</span>: <span style="color:#66d9ef">monaco.languages.typescript.ScriptTarget.ES5</span>, <span style="color:#75715e">// 编译目标位ES5
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">allowNonTsExtensions</span>: <span style="color:#66d9ef">true</span>, <span style="color:#75715e">// 允许非TS扩展名
</span><span style="color:#75715e"></span>        <span style="color:#66d9ef">module</span><span style="color:#a6e22e">Resolution</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">languages</span>.<span style="color:#a6e22e">typescript</span>.<span style="color:#a6e22e">ModuleResolutionKind</span>.<span style="color:#a6e22e">NodeJs</span>, <span style="color:#75715e">// 模块解析方式：NodeJs
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">module</span>: <span style="color:#66d9ef">monaco.languages.typescript.ModuleKind.CommonJS</span>, <span style="color:#75715e">// 模块导入方式：CommonJS
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">jsx</span>: <span style="color:#66d9ef">monaco.languages.typescript.JsxEmit.React</span>, <span style="color:#75715e">// 启用JSX（React方式）
</span><span style="color:#75715e"></span>        <span style="color:#a6e22e">typeRoots</span><span style="color:#f92672">:</span> [<span style="color:#e6db74">&#34;dist/monaco/@types/&#34;</span>] <span style="color:#75715e">// 类型定义根目录
</span><span style="color:#75715e"></span>    });

    <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;dist/monaco/@types/react/index.d.ts&#39;</span>) <span style="color:#75715e">// 抓取React的定义文件
</span><span style="color:#75715e"></span>        .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">response</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">text</span>())
        .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">data</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">data</span>.<span style="color:#a6e22e">replace</span>(<span style="color:#e6db74">`export = React;`</span>, <span style="color:#e6db74">``</span>)) <span style="color:#75715e">// 将不必要的模块导出声明删掉（这是用于TypeScript的模拟经典CommonJS、AMD方式的写法）
</span><span style="color:#75715e"></span>        .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">data</span> <span style="color:#f92672">=&gt;</span> {
            <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_libDisposable</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>) { 
                <span style="color:#75715e">// 添加引用的库，并加入到待释放列表中
</span><span style="color:#75715e"></span>                <span style="color:#75715e">// 首先添加 题型定义 中会用到的一些类型的定义
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_libDisposable</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">languages</span>.<span style="color:#a6e22e">typescript</span>.<span style="color:#a6e22e">typescriptDefaults</span>.<span style="color:#a6e22e">addExtraLib</span>(<span style="color:#e6db74">`
</span><span style="color:#e6db74">declare interface IQuestionModel {
</span><span style="color:#e6db74">[key: string]: any,
</span><span style="color:#e6db74">id: number,
</span><span style="color:#e6db74">questionaireId: number,
</span><span style="color:#e6db74">typeId: number,
</span><span style="color:#e6db74">order: number,
</span><span style="color:#e6db74">content: string,
</span><span style="color:#e6db74">createdAt: Date,
</span><span style="color:#e6db74">updatedAt: Date,
</span><span style="color:#e6db74">}
</span><span style="color:#e6db74">declare interface IAnswerModel {
</span><span style="color:#e6db74">[key: string]: any,
</span><span style="color:#e6db74">id: number,
</span><span style="color:#e6db74">content: string,
</span><span style="color:#e6db74">sessionId: string,
</span><span style="color:#e6db74">timeSpent: number,
</span><span style="color:#e6db74">questionId: number,
</span><span style="color:#e6db74">ownerIP: string,
</span><span style="color:#e6db74">createdAt: Date,
</span><span style="color:#e6db74">updatedAt: Date,
</span><span style="color:#e6db74">}
</span><span style="color:#e6db74">declare interface ICreateQuestionTypeComponentProps {
</span><span style="color:#e6db74">question: IQuestionModel,
</span><span style="color:#e6db74">questions: IQuestionModel[],
</span><span style="color:#e6db74">content: string, // save settings in [content]
</span><span style="color:#e6db74">onContentChanged: (content: string) =&gt; void,
</span><span style="color:#e6db74">}
</span><span style="color:#e6db74">declare interface IShowQuestionTypeComponentProps {
</span><span style="color:#e6db74">question: IQuestionModel,
</span><span style="color:#e6db74">questions: IQuestionModel[],
</span><span style="color:#e6db74">answers: IAnswerModel[],
</span><span style="color:#e6db74">createContent: string, // [ICreateQuestionTypeComponentProps.content] settings of the component
</span><span style="color:#e6db74">content: string, // save answer in [content]
</span><span style="color:#e6db74">onSubmit: (content: string, nextQuestionIndex?: number) =&gt; void,
</span><span style="color:#e6db74">}
</span><span style="color:#e6db74">`</span>, <span style="color:#e6db74">&#39;dist/monaco/@types/questionTypeInterfaces/index.d.ts&#39;</span>))

                <span style="color:#75715e">// 然后，将抓取到的React的定义文件加入到库中
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_libDisposable</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">languages</span>.<span style="color:#a6e22e">typescript</span>.<span style="color:#a6e22e">typescriptDefaults</span>.<span style="color:#a6e22e">addExtraLib</span>(<span style="color:#a6e22e">data</span>, <span style="color:#e6db74">&#39;dist/monaco/@types/react/index.d.ts&#39;</span>));
            }
        });

    <span style="color:#75715e">// 关闭语法语义验证（因为缺少部分定义可能导致很多报错）
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">languages</span>.<span style="color:#a6e22e">typescript</span>.<span style="color:#a6e22e">typescriptDefaults</span>.<span style="color:#a6e22e">setDiagnosticsOptions</span>({
        <span style="color:#a6e22e">noSemanticValidation</span>: <span style="color:#66d9ef">false</span>,
        <span style="color:#a6e22e">noSyntaxValidation</span>: <span style="color:#66d9ef">false</span>
    });

    <span style="color:#75715e">// 根据代码内容，并为代码文件命名，创建并存储编辑器的内容模型
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_createFormEditorModel</span>) {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_createFormEditorModel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">editor</span>.<span style="color:#a6e22e">createModel</span>(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">ceateFormTSX</span>, <span style="color:#e6db74">&#39;typescript&#39;</span>, <span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">Uri</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#e6db74">&#39;file:///create.tsx&#39;</span>))
    }

    <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_showFormEditorModel</span>) {
        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_showFormEditorModel</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">editor</span>.<span style="color:#a6e22e">createModel</span>(<span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">showFormTSX</span>, <span style="color:#e6db74">&#39;typescript&#39;</span>, <span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">Uri</span>.<span style="color:#a6e22e">parse</span>(<span style="color:#e6db74">&#39;file:///show.tsx&#39;</span>))
    }
}
</code></pre></div><blockquote>
<p>也许你注意到了，在Monaco的配置中，目录都是虚拟的，即使已经定义了typeRoot，但编辑器不会真的去自动加载目录内所有的库（毕竟是客户端页面，这是可以理解的），所以后面我们必须手动添加导入的库的内容。</p>
</blockquote>
<h3 id="保存代码结果">保存代码结果</h3>
<p>现在，编辑器已经可以让用户自行设计题型，直接在网页上写代码的体验还是非常不错的。Monaco的智能感知以及相当丰富的快捷命令能够极大的提高编程体验。</p>
<p>但是，代码完成后，如何保存？也许你还记得，前面数据库设计中，有源程序，还有编译后的程序。</p>
<p>这是因为，源程序是这里的TypeScript，方便用户编辑；而前端最终呈现的时候，是通过浏览器，就必须使用编译后的程序。</p>
<p>那么编译后的程序从哪里来呢？Monaco其实已经提供了原生支持。</p>
<p>我们需要调用Monaco的<code>TypeScriptWorker</code>得到编译后结果，因为最开始初始化的时候我们设定了编译的target是ES5，所以我们在这里得到的也就是主流浏览器都可以兼容的ES5。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">private</span> <span style="color:#a6e22e">_onSubmit() {</span>

    <span style="color:#75715e">// 只读模式不可提交保存
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">isOnlyView</span>) <span style="color:#66d9ef">return</span>;

    <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setState</span>({ <span style="color:#a6e22e">isSubmitting</span>: <span style="color:#66d9ef">true</span> });

    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">model</span> <span style="color:#f92672">=</span> { ...<span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">model</span> };

    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">pThis</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>; <span style="color:#75715e">// 下面代码的深层闭包中用到了pThis，此处已被省略。
</span><span style="color:#75715e"></span>
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">createFormEditorModel</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_createFormEditorModel</span>;
    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">showFormEditorModel</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">_showFormEditorModel</span>;
    <span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">languages</span>.<span style="color:#a6e22e">typescript</span>.<span style="color:#a6e22e">getTypeScriptWorker</span>()
        .<span style="color:#a6e22e">then</span>(<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">worker</span>: <span style="color:#66d9ef">any</span>) {
            <span style="color:#a6e22e">worker</span>(<span style="color:#a6e22e">createFormEditorModel</span>.<span style="color:#a6e22e">uri</span>)
                .<span style="color:#a6e22e">then</span>(<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">client</span>: <span style="color:#66d9ef">any</span>) {
                    <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">getEmitOutput</span>(<span style="color:#a6e22e">createFormEditorModel</span>.<span style="color:#a6e22e">uri</span>.<span style="color:#a6e22e">toString</span>())
                        .<span style="color:#a6e22e">then</span>(<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">res</span>: <span style="color:#66d9ef">any</span>) {

                            <span style="color:#75715e">// 这里拿到了编译后的创建题目表单代码
</span><span style="color:#75715e"></span>                            <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">compiledCreateForm</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">outputFiles</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">text</span>;

                            <span style="color:#a6e22e">monaco</span>.<span style="color:#a6e22e">languages</span>.<span style="color:#a6e22e">typescript</span>.<span style="color:#a6e22e">getTypeScriptWorker</span>()
                                .<span style="color:#a6e22e">then</span>(<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">worker</span>: <span style="color:#66d9ef">any</span>) {
                                    <span style="color:#a6e22e">worker</span>(<span style="color:#a6e22e">showFormEditorModel</span>.<span style="color:#a6e22e">uri</span>)
                                        .<span style="color:#a6e22e">then</span>(<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">client</span>: <span style="color:#66d9ef">any</span>) {
                                            <span style="color:#a6e22e">client</span>.<span style="color:#a6e22e">getEmitOutput</span>(<span style="color:#a6e22e">showFormEditorModel</span>.<span style="color:#a6e22e">uri</span>.<span style="color:#a6e22e">toString</span>())
                                                .<span style="color:#a6e22e">then</span>(<span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">res</span>: <span style="color:#66d9ef">any</span>) {

                                                    <span style="color:#75715e">// 这里拿到了编译后的展示题目表单代码
</span><span style="color:#75715e"></span>                                                    <span style="color:#a6e22e">model</span>.<span style="color:#a6e22e">compiledShowForm</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">outputFiles</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">text</span>;

                                                    <span style="color:#75715e">// 后面是保存到数据库的调用
</span><span style="color:#75715e"></span>                                                    <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;api/QuestionType&#39;</span>, {
                                                        <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {
                                                            <span style="color:#e6db74">&#39;Accept&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;application/json&#39;</span>,
                                                            <span style="color:#e6db74">&#39;Content-Type&#39;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;application/json&#39;</span>
                                                        },
                                                        <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;POST&#39;</span>,
                                                        <span style="color:#a6e22e">body</span>: <span style="color:#66d9ef">JSON.stringify</span>(<span style="color:#a6e22e">model</span>)
                                                    })
                                                        .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">response</span> <span style="color:#f92672">=&gt;</span> {
                                                            <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>                                                        })
                                                        <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>                                                });
                                        });
                                });
                        });
                });
        });
}
</code></pre></div><h2 id="调用并渲染存储的题型表单">调用并渲染存储的题型表单</h2>
<p>现在只差最后一步，就是将代码转换为最终渲染出来的组件。</p>
<p><code>DynamicQuestionTypeComponent</code>类就是专门做这件事情的。该类将代码的抓取封装在内，本身可作为一个React组件使用。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IDynamicQuestionTypeComponentProps</span> {
    <span style="color:#a6e22e">questionTypeId</span>: <span style="color:#66d9ef">number</span>, <span style="color:#75715e">// 题型ID
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">formType</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;create&#39;</span> <span style="color:#f92672">|</span> <span style="color:#e6db74">&#39;show&#39;</span>, <span style="color:#75715e">// 是 创建题目表单 还是 展示题目表单
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">componentProps</span>: <span style="color:#66d9ef">ICreateQuestionTypeComponentProps</span> <span style="color:#f92672">|</span> <span style="color:#a6e22e">IShowQuestionTypeComponentProps</span>, <span style="color:#75715e">// 题目表单属性
</span><span style="color:#75715e"></span>}

<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IDynamicQuestionTypeComponentState</span> {
    <span style="color:#a6e22e">component</span>: <span style="color:#66d9ef">any</span>, <span style="color:#75715e">// 组件实例
</span><span style="color:#75715e"></span>}

<span style="color:#66d9ef">export</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DynamicQuestionTypeComponent</span>
    <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">HasFetchComponent</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">IDynamicQuestionTypeComponentProps</span>, <span style="color:#a6e22e">IDynamicQuestionTypeComponentState</span><span style="color:#f92672">&gt;</span> {

    <span style="color:#66d9ef">constructor</span>(<span style="color:#a6e22e">props</span>: <span style="color:#66d9ef">IDynamicQuestionTypeComponentProps</span>) {
        <span style="color:#66d9ef">super</span>(<span style="color:#a6e22e">props</span>);

        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span> <span style="color:#f92672">=</span> {
            <span style="color:#a6e22e">component</span>: <span style="color:#66d9ef">null</span>,
        }
    }

    <span style="color:#a6e22e">componentDidMount() {</span>
        <span style="color:#66d9ef">super</span>.<span style="color:#a6e22e">componentDidMount</span>();

        <span style="color:#75715e">// 抓取题型表单代码
</span><span style="color:#75715e"></span>
        <span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#39;api/QuestionType/&#39;</span> <span style="color:#f92672">+</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">questionTypeId</span>)
            .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">response</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">response</span>.<span style="color:#a6e22e">json</span>() <span style="color:#66d9ef">as</span> <span style="color:#a6e22e">Promise</span><span style="color:#f92672">&lt;</span><span style="color:#a6e22e">IQuestionTypeModel</span><span style="color:#f92672">&gt;</span>)
            .<span style="color:#a6e22e">then</span>(<span style="color:#a6e22e">data</span> <span style="color:#f92672">=&gt;</span> {

                <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">code</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">formType</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;create&#39;</span> <span style="color:#f92672">?</span> <span style="color:#a6e22e">data.compiledCreateForm</span> : <span style="color:#66d9ef">data.compiledShowForm</span>;

                <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">context</span>: <span style="color:#66d9ef">any</span> <span style="color:#f92672">=</span> {};
                <span style="color:#75715e">// 注：eval已经不建议被使用，应该换成Function类。这里尊重我当时写的源代码。
</span><span style="color:#75715e"></span>                <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">requireComponent</span> <span style="color:#f92672">=</span> eval(<span style="color:#e6db74">`(function (exports, React) {`</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">code</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">`})`</span>);

                <span style="color:#a6e22e">requireComponent</span>(<span style="color:#a6e22e">context</span>, <span style="color:#a6e22e">React</span>);

                <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">setStateWhenMount</span>({ <span style="color:#a6e22e">component</span>: <span style="color:#66d9ef">context.ExampleQuestionType</span> });
            })
            .<span style="color:#66d9ef">catch</span>(<span style="color:#a6e22e">error</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#a6e22e">error</span>));
    }

    <span style="color:#a6e22e">render() {</span>

        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">Component</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">state</span>.<span style="color:#a6e22e">component</span>;
        <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">componentProps</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">props</span>.<span style="color:#a6e22e">componentProps</span>;

        <span style="color:#66d9ef">return</span> (
            <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">div</span><span style="color:#f92672">&gt;</span>
                <span style="color:#75715e">/* 如果 组件尚未加载成功，显示Loading... */</span>
                {<span style="color:#f92672">!</span><span style="color:#a6e22e">Component</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">InfoBar</span>
                    <span style="color:#a6e22e">infoText</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Loading...&#39;</span>
                <span style="color:#f92672">/&gt;</span>}

                <span style="color:#75715e">/* 如果组件加载成功，渲染组件，设定组件属性 */</span>
                {<span style="color:#a6e22e">Component</span> <span style="color:#f92672">&amp;&amp;</span>
                    <span style="color:#f92672">&lt;</span><span style="color:#a6e22e">Component</span>
                        {...<span style="color:#a6e22e">componentProps</span>}
                    <span style="color:#f92672">/&gt;</span>
                }
            <span style="color:#f92672">&lt;</span><span style="color:#960050;background-color:#1e0010">/div&gt;</span>
        );
    }
}
</code></pre></div><h2 id="结语">结语</h2>
<p>上述看似复杂的流程也确实是经过我对Monaco/TypeScript/React的多番调研才总结并实现出来的，费了很大的功夫。因此才特意写了这一系列的文章。</p>
<p>可以说，这个问卷系统的项目并不复杂，而这里就占了一半多。可能讲用户需求，这样的问卷系统实在小众，而且我也只是做了一个简单的demo，几乎不能实际应用——但这里用到的设计思路，自我感觉还是非常有新意，技术手段也有难度和深度，也许在其他项目中就可以有所应用。</p>
<p>本系列文章到这里就接近尾声，介绍的细节十分有限，但大体思路相比还是能够有所体现，更具体的东西肯定还是查阅代码更为妥当。</p>
<p>接下来还有一篇，仅仅是Demo介绍而已，希望可以给大家一个更清晰的功能展示，找到技术点在作品中实际的映射。</p>


    

    

    <h4 class="related-header">相关文章</h4>
    <ul>
        
            <li><a href="/2018/08/%E7%AE%80%E6%98%93%E9%97%AE%E5%8D%B7%E7%B3%BB%E7%BB%9F%E4%BA%8C%E6%8E%A5%E5%8F%A3%E8%AE%BE%E8%AE%A1/">简易问卷系统（二）接口设计</a></li>
        
            <li><a href="/2018/08/%E7%AE%80%E6%98%93%E9%97%AE%E5%8D%B7%E7%B3%BB%E7%BB%9F%E4%B8%80%E8%83%8C%E6%99%AF%E5%92%8C%E6%A8%A1%E5%9E%8B%E8%AE%BE%E8%AE%A1/">简易问卷系统（一）背景和模型设计</a></li>
        
    </ul>


</article>

<div id="gitalk-container"></div>



        </div>

        <aside class="col-12 col-lg-3 ml-auto blog-sidebar">
    
        


<section>
    <h4>近期文章</h4>
    <ol class="list-unstyled">
        
        <li>
            <a href="/post/">Posts</a>
        </li>
        
        <li>
            <a href="/2024/02/%E4%B8%80%E5%B9%B4/">一年</a>
        </li>
        
        <li>
            <a href="/2023/01/%E4%B8%80%E5%B9%B4/">一年</a>
        </li>
        
        <li>
            <a href="/2022/09/%E8%AF%BB%E5%A4%A7%E8%A7%84%E6%A8%A1c-%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%B0%88%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/">读《大规模C++程序设计》，谈架构设计</a>
        </li>
        
        <li>
            <a href="/2020/07/editflow%E7%B3%BB%E5%88%97%E4%B8%89%E4%BD%BF%E7%94%A8blender%E5%88%B6%E4%BD%9C%E5%AE%A3%E4%BC%A0%E7%89%87/">editflow系列（三）：使用Blender制作宣传片</a>
        </li>
        
    </ol>
</section>

    
    
        <section>
    
        
        <h4>分类</h4>
        <p>
            
            <a class="badge badge-primary" href="/categories/cpp">cpp</a>
            
            <a class="badge badge-primary" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">学习笔记</a>
            
            <a class="badge badge-primary" href="/categories/%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0">开发笔记</a>
            
            <a class="badge badge-primary" href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0">机器学习</a>
            
            <a class="badge badge-primary" href="/categories/%E7%94%9F%E6%B4%BB">生活</a>
            
            <a class="badge badge-primary" href="/categories/%E9%98%85%E8%AF%BB">阅读</a>
            
        </p>
        
    
        
        <h4>标签</h4>
        <p>
            
            <a class="badge badge-primary" href="/tags/asp.net-core">asp.net-core</a>
            
            <a class="badge badge-primary" href="/tags/blender">blender</a>
            
            <a class="badge badge-primary" href="/tags/c&#43;&#43;">c&#43;&#43;</a>
            
            <a class="badge badge-primary" href="/tags/cmake">cmake</a>
            
            <a class="badge badge-primary" href="/tags/concept">concept</a>
            
            <a class="badge badge-primary" href="/tags/cpp">cpp</a>
            
            <a class="badge badge-primary" href="/tags/dag">dag</a>
            
            <a class="badge badge-primary" href="/tags/git">git</a>
            
            <a class="badge badge-primary" href="/tags/hooks">hooks</a>
            
            <a class="badge badge-primary" href="/tags/laravel">laravel</a>
            
            <a class="badge badge-primary" href="/tags/macos">macos</a>
            
            <a class="badge badge-primary" href="/tags/monaco">monaco</a>
            
            <a class="badge badge-primary" href="/tags/opengl">opengl</a>
            
            <a class="badge badge-primary" href="/tags/python">python</a>
            
            <a class="badge badge-primary" href="/tags/react">react</a>
            
            <a class="badge badge-primary" href="/tags/restful">restful</a>
            
            <a class="badge badge-primary" href="/tags/rvalue">rvalue</a>
            
            <a class="badge badge-primary" href="/tags/sigmoid">sigmoid</a>
            
            <a class="badge badge-primary" href="/tags/traits">traits</a>
            
            <a class="badge badge-primary" href="/tags/type">type</a>
            
            <a class="badge badge-primary" href="/tags/type-traits">type-traits</a>
            
            <a class="badge badge-primary" href="/tags/typescript">typescript</a>
            
            <a class="badge badge-primary" href="/tags/workflow">workflow</a>
            
            <a class="badge badge-primary" href="/tags/%E4%BA%8C%E5%85%83%E5%88%86%E7%B1%BB">二元分类</a>
            
            <a class="badge badge-primary" href="/tags/%E4%BF%A1%E5%BF%B5%E7%BD%91%E7%BB%9C">信念网络</a>
            
            <a class="badge badge-primary" href="/tags/%E5%85%AC%E5%85%B1%E8%87%AA%E8%A1%8C%E8%BD%A6">公共自行车</a>
            
            <a class="badge badge-primary" href="/tags/%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%BA%93">动态链接库</a>
            
            <a class="badge badge-primary" href="/tags/%E5%8C%97%E4%BA%AC%E5%B8%88%E8%8C%83%E5%A4%A7%E5%AD%A6">北京师范大学</a>
            
            <a class="badge badge-primary" href="/tags/%E5%8E%86%E5%8F%B2">历史</a>
            
            <a class="badge badge-primary" href="/tags/%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD">反向传播</a>
            
            <a class="badge badge-primary" href="/tags/%E5%9B%BE%E6%A8%A1%E5%9E%8B">图模型</a>
            
            <a class="badge badge-primary" href="/tags/%E5%9B%BE%E8%AE%BA">图论</a>
            
            <a class="badge badge-primary" href="/tags/%E5%A4%9A%E5%85%83%E5%88%86%E7%B1%BB">多元分类</a>
            
            <a class="badge badge-primary" href="/tags/%E5%A4%9A%E9%A1%B9%E5%BC%8F%E5%9B%9E%E5%BD%92">多项式回归</a>
            
            <a class="badge badge-primary" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0">学习笔记</a>
            
            <a class="badge badge-primary" href="/tags/%E5%B7%A5%E4%BD%9C%E6%B5%81">工作流</a>
            
            <a class="badge badge-primary" href="/tags/%E5%BD%92%E4%B8%80%E5%8C%96">归一化</a>
            
            <a class="badge badge-primary" href="/tags/%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%8F%B7">微信公众号</a>
            
            <a class="badge badge-primary" href="/tags/%E6%80%A7%E8%83%BD">性能</a>
            
            <a class="badge badge-primary" href="/tags/%E6%95%8F%E6%8D%B7">敏捷</a>
            
            <a class="badge badge-primary" href="/tags/%E6%95%99%E5%8A%A1%E5%8A%A9%E6%89%8B">教务助手</a>
            
            <a class="badge badge-primary" href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93">数据库</a>
            
            <a class="badge badge-primary" href="/tags/%E6%97%A7%E4%BA%8B%E9%87%8D%E6%8F%90">旧事重提</a>
            
            <a class="badge badge-primary" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0">机器学习</a>
            
            <a class="badge badge-primary" href="/tags/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1">架构设计</a>
            
            <a class="badge badge-primary" href="/tags/%E6%A0%A1%E5%9B%AD">校园</a>
            
            <a class="badge badge-primary" href="/tags/%E6%A2%AF%E5%BA%A6%E4%B8%8B%E9%99%8D">梯度下降</a>
            
            <a class="badge badge-primary" href="/tags/%E6%A6%82%E7%8E%87">概率</a>
            
            <a class="badge badge-primary" href="/tags/%E6%AD%A3%E8%A7%84%E5%8C%96">正规化</a>
            
            <a class="badge badge-primary" href="/tags/%E6%AD%A3%E8%A7%84%E6%96%B9%E7%A8%8B">正规方程</a>
            
            <a class="badge badge-primary" href="/tags/%E6%B5%8B%E8%AF%95">测试</a>
            
            <a class="badge badge-primary" href="/tags/%E7%94%9F%E6%B4%BB">生活</a>
            
            <a class="badge badge-primary" href="/tags/%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C">神经网络</a>
            
            <a class="badge badge-primary" href="/tags/%E7%AE%97%E6%B3%95">算法</a>
            
            <a class="badge badge-primary" href="/tags/%E7%BA%BF%E6%80%A7%E5%9B%9E%E5%BD%92">线性回归</a>
            
            <a class="badge badge-primary" href="/tags/%E7%BC%96%E7%A8%8B">编程</a>
            
            <a class="badge badge-primary" href="/tags/%E7%BC%96%E8%AF%91">编译</a>
            
            <a class="badge badge-primary" href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6">计算机图形学</a>
            
            <a class="badge badge-primary" href="/tags/%E8%AE%B0%E5%BF%86">记忆</a>
            
            <a class="badge badge-primary" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0">读书笔记</a>
            
            <a class="badge badge-primary" href="/tags/%E8%B8%8F%E9%B8%BD%E8%A1%8C">踏鸽行</a>
            
            <a class="badge badge-primary" href="/tags/%E9%80%BB%E8%BE%91%E5%87%BD%E6%95%B0">逻辑函数</a>
            
            <a class="badge badge-primary" href="/tags/%E9%80%BB%E8%BE%91%E5%9B%9E%E5%BD%92">逻辑回归</a>
            
            <a class="badge badge-primary" href="/tags/%E9%87%8D%E6%9E%84">重构</a>
            
            <a class="badge badge-primary" href="/tags/%E9%93%BE%E6%8E%A5">链接</a>
            
            <a class="badge badge-primary" href="/tags/%E9%9A%8F%E7%AC%94">随笔</a>
            
        </p>
        
    
</section>
    
</aside>

      </div>
    </div>
    

    
    






<footer class="blog-footer w-100">
    <nav class="navbar navbar-light bg-light">
        <p class="w-100 text-center"><a href="https://beian.miit.gov.cn" target="_blank">Hongxu Xu © 2020 苏ICP备2021014763号-1</a></p>
        <p class="w-100 text-center"><a href="#">回到顶部</a></p>
    </nav>
</footer>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
            extensions: ["AMSmath.js", "AMSsymbols.js"] }
    }
});
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax();
    for(var i = 0; i != all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<script type="text/javascript">
    String.prototype.trimEnd = function (str) {
        if (this.endsWith(str)) {
            return this.substring(0, this.length - str.length);
        }
        return this;
    }

    function cleanedHref() {
        var res = location.href.trim();
        var regex = /(index\.html?|[#/])+$/gi;
        return res.replace(regex, '')
    }

    var gitalk = new Gitalk({
        clientID: 'dd67fbd38a74844e6dce',
        clientSecret: '7278e4bf15c952b3491d7c61716b9672962f4460',
        repo: 'xuhongxu96.github.io',
        owner: 'xuhongxu96',
        admin: ['xuhongxu96'],
        id: "2c45733b97e17c7af4a85e82d0145ec0",      
        distractionFreeMode: true  
    })

    gitalk.render('gitalk-container')
</script>
    

    
    
    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.slim.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.bootcss.com/popper.js/1.15.0/umd/popper.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.min.js" crossorigin="anonymous"></script>
</body>

</html>